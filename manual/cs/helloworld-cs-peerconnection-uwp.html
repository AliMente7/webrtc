<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Creating a peer connection | MixedReality-WebRTC Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Creating a peer connection | MixedReality-WebRTC Documentation ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="../../mr-webrtc_icon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120" data-uid="">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../mr-webrtc_icon.png" alt="MixedReality-WebRTC">
                <span>MixedReality-WebRTC</span>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" id="branch-selector">
                <select name="branch"></select>
              </form>
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="creating-a-peer-connection">Creating a peer connection</h1>

<p>Next, we create a <a class="xref" href="../../api/Microsoft.MixedReality.WebRTC.PeerConnection.html"><code>PeerConnection</code></a> object which encapsulates the connection to the remote peer.</p>
<p>The <a class="xref" href="../../api/Microsoft.MixedReality.WebRTC.PeerConnection.html"><code>PeerConnection</code></a> class is marked as disposable, so must be disposed to clean-up the native resources. Failing to do so generally lead to crashes or hangs, as the internal WebRTC threads are not stopped and therefore the native DLL cannot be unloaded. Unlike in the <a href="helloworld-cs-peerconnection-core3.html">.NET Core tutorial</a> where we build a console application however, here with the XAML framework we cannot easily use the <code>using var</code> construct to rely on the C# compiler to call the <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.idisposable.dispose#System_IDisposable_Dispose"><code>Dispose()</code></a> method for us, because currently the only available method is the <code>OnLoaded()</code> method, and it will terminate and release all its local variable once loading is finished, and before the end of the application. Instead, we need to keep a reference to the <a class="xref" href="../../api/Microsoft.MixedReality.WebRTC.PeerConnection.html"><code>PeerConnection</code></a> instance and call <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.idisposable.dispose#System_IDisposable_Dispose"><code>Dispose()</code></a> explicitly when done with it.</p>
<p>Continue editing the <code>MainPage.xaml.cs</code> file and append the following:</p>
<ol>
<li><p>At the top of the <code>MainPage</code> class, declare a private variable of type <code>PeerConnection</code>.</p>
<pre><code class="lang-cs">private PeerConnection _peerConnection;
</code></pre>
</li>
<li><p>Continue to append to the <code>OnLoaded()</code> method. First, instantiate the peer connection.</p>
<pre><code class="lang-cs">_peerConnection = new PeerConnection();
</code></pre>
</li>
<li><p>The <a class="xref" href="../../api/Microsoft.MixedReality.WebRTC.PeerConnection.html"><code>PeerConnection</code></a> object is initally created in an idle state where it cannot be used until initialized with a call to <a class="xref" href="../../api/Microsoft.MixedReality.WebRTC.PeerConnection.html#Microsoft_MixedReality_WebRTC_PeerConnection_InitializeAsync_Microsoft_MixedReality_WebRTC_PeerConnectionConfiguration_CancellationToken_"><code>InitializeAsync()</code></a>. This method takes a <a class="xref" href="../../api/Microsoft.MixedReality.WebRTC.PeerConnectionConfiguration.html"><code>PeerConnectionConfiguration</code></a> object which allows specifying some options to configure the connection. In this tutorial, most default options are suitable, but we want to specify a STUN server to make sure that the peer connection can connect to the remote peer even if behind a <a href="https://en.wikipedia.org/wiki/Network_address_translation">NAT</a>.</p>
<pre><code class="lang-cs">var config = new PeerConnectionConfiguration
{
    IceServers = new List&lt;IceServer&gt; {
            new IceServer{ Urls = { &quot;stun:stun.l.google.com:19302&quot; } }
        }
};
await _peerConnection.InitializeAsync(config);
</code></pre>
<p>In this example we use a free STUN server courtesy of Google. Note that this is fine for testing, but <strong>must not be used for production</strong>. Also, the ICE server list uses the <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.collections.generic.list-1"><code>List&lt;&gt;</code></a> generic class, so we need to import the <code>System.Collections.Generic</code> module with a <code>using</code> directive at the top of the file.</p>
<pre><code class="lang-cs">using System.Collections.Generic;
</code></pre>
</li>
<li><p>Print a simple message to the debugger to confirm that the peer connection wass initialized. In a real-world application, properly notifying the user of failures is critical, but here for the sake of this tutorial we simply rely on a any exception interrupting the application before the message is printed if an error occur.</p>
<pre><code class="lang-cs">Debugger.Log(0, &quot;&quot;, &quot;Peer connection initialized successfully.\n&quot;);
</code></pre>
</li>
<li><p>In the <code>App_Suspending()</code> event handler, add some code to dispose of the peer connection.</p>
<pre><code class="lang-cs">private void App_Suspending(object sender, SuspendingEventArgs e)
{
    if (_peerConnection != null)
    {
        _peerConnection.Close();
        _peerConnection.Dispose();
        _peerConnection = null;
    }
}
</code></pre>
</li>
</ol>
<p>Run the application again; the printed message should appear after some time in the Visual Studio <strong>Output</strong> window under the <strong>Debug</strong> section. It can take up to a few seconds to initialize the peer connection, depending on the device.</p>
<p><img src="cs-uwp11.png" alt="Peer connection initialized"></p>
<hr>
<p>Next : <a href="helloworld-cs-mediatracks-uwp.html">Adding local media tracks</a></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/microsoft/MixedReality-WebRTC/blob/master/docs/manual/cs/helloworld-cs-peerconnection-uwp.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/branches.gen.js"></script>
    <script type="text/javascript" src="../../styles/branch-selector.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
